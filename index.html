<!DOCTYPE html>

<head>
    <title>Barebones Tutorial</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha/css/bootstrap.min.css" />
</head>

<body lang="en">
    <div class="container">
        <h1>User Manager</h1>
        <hr>
        <!-- container for our user list and user forms -->
        <div class="page">
        </div>
    </div>
    
    <script type="text/template" id="user-list-template">
        <h4>Testing Template</h4>
        <table class="table striped">
        <thead>
           <tr>
              <th>First Name</th>
              <th>Last Name</th>
              <th>Age</th>
              <th></th>
           </tr>
        </thead>
           <tbody>
              <% _.each(users,function(user) { %>
                  <tr>
                     <td><%= user.get('firstname') %></td>
                     <td><%= user.get('lastname') %></td>
                     <td><%= user.get('age') %></td>
                     <td></td>
                  </tr>     
              <% }); %>
           </tbody>
        </table>
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.2.3/backbone-min.js"></script>
    <!-- inline script just for the tutorial; make this modular later -->
    <script>
        
        /* declare the collection and its source */
        var Users = Backbone.Collection.extend({
            url: 'http://backbone-beginner.herokuapp.com/users/'
        });
        
        /* declare the user list view, the element that will house it, and the render function */ 
        var UserList = Backbone.View.extend({
            el: '.page',
            render: function() {
                var that = this;
                var users = new Users();
                users.fetch({
                    success: function(users){
                        var template = _.template($('#user-list-template').html());
                        that.$el.html(template({"users": users.models}));
                    }    
                });
            }
        });
        
        /* declare the router and what routes we will listen for/respond to */
        var Router = Backbone.Router.extend({
           routes: {
               '': 'home'
           } 
        });
        
        /* instantiate the user list view */
        var userList = new UserList();
        
        /* instantiate the router */
        var router = new Router();
        
        /* pair the router's routes with their corresponding functions */
        router.on('route:home', function() {
            userList.render();
        });
        
        /* have backbone start actively listening for changes in requested URL address */
        Backbone.history.start();
    </script>
</body>

</html>